<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="euc-kr">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>finance.js 변경사항 비교</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            color: #4ec9b0;
            margin-bottom: 30px;
            font-size: 28px;
            text-align: center;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        .panel {
            background: #252526;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #3e3e42;
        }
        .panel-header {
            background: #2d2d30;
            padding: 12px 20px;
            font-weight: bold;
            border-bottom: 2px solid #007acc;
        }
        .original { border-bottom-color: #ce9178; }
        .changed { border-bottom-color: #4ec9b0; }
        .code {
            padding: 20px;
            font-size: 13px;
            overflow-x: auto;
        }
        .highlight-remove {
            background: rgba(255, 0, 0, 0.2);
            border-left: 3px solid #f14c4c;
            padding-left: 10px;
            margin-left: -10px;
            display: block;
        }
        .highlight-add {
            background: rgba(0, 255, 0, 0.2);
            border-left: 3px solid #89d185;
            padding-left: 10px;
            margin-left: -10px;
            display: block;
        }
        .highlight-new {
            background: rgba(100, 149, 237, 0.2);
            border-left: 3px solid #6495ed;
            padding-left: 10px;
            margin-left: -10px;
            display: block;
        }
        .comment {
            color: #6a9955;
        }
        .string {
            color: #ce9178;
        }
        .keyword {
            color: #569cd6;
        }
        .function {
            color: #dcdcaa;
        }
        .legend {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-bottom: 30px;
            padding: 15px;
            background: #252526;
            border-radius: 8px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .legend-box {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        .box-remove { background: rgba(255, 0, 0, 0.3); border: 2px solid #f14c4c; }
        .box-add { background: rgba(0, 255, 0, 0.3); border: 2px solid #89d185; }
        .box-new { background: rgba(100, 149, 237, 0.3); border: 2px solid #6495ed; }
        pre { margin: 0; white-space: pre-wrap; word-break: break-word; }
        @media (max-width: 1200px) {
            .comparison { grid-template-columns: 1fr; }
        }
        .section-title {
            color: #dcdcaa;
            font-size: 18px;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #3e3e42;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>finance.js 변경사항 상세 비교</h1>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-box box-remove"></div>
                <span>삭제된 코드</span>
            </div>
            <div class="legend-item">
                <div class="legend-box box-add"></div>
                <span>수정/변경된 코드</span>
            </div>
            <div class="legend-item">
                <div class="legend-box box-new"></div>
                <span>새로 추가된 코드</span>
            </div>
        </div>

        <h2 class="section-title">① 스크롤 감지 플래그 변수 추가</h2>
        <div class="comparison">
            <div class="panel">
                <div class="panel-header original">기존 코드</div>
                <div class="code">
<pre>$(<span class="keyword">document</span>).ready(<span class="keyword">function</span>() {
    <span class="keyword">const</span> isMobile = () =&gt; window.innerWidth &lt;= 768;
    
    <span class="comment">// 초기 상태 설정</span>
    <span class="keyword">function</span> <span class="function">initPanels</span>() {
        ...</pre>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header changed">변경된 코드</div>
                <div class="code">
<pre><span class="keyword">let</span> resizeTimer;
$(window).on(<span class="string">'resize'</span>, <span class="keyword">function</span>() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
<span class="highlight-add">        <span class="keyword">if</span> (isMobile()) {</span>
<span class="highlight-add">            setupMobileScroll();</span>
<span class="highlight-new">            $(<span class="string">'body'</span>).off(<span class="string">'keydown.finance'</span>);</span>
<span class="highlight-new">            $(<span class="string">'body'</span>).off(<span class="string">'keydown.tabtonav'</span>);</span>
<span class="highlight-add">        } <span class="keyword">else</span> {</span>
<span class="highlight-new">            $(<span class="string">'.visual-container'</span>).removeClass(<span class="string">'sticky'</span>);</span>
<span class="highlight-new">            $(<span class="string">'.anchor-list'</span>).removeClass(<span class="string">'fixed'</span>).css(<span class="string">'padding'</span>, <span class="string">''</span>);</span>
<span class="highlight-new">            $(<span class="string">'body'</span>).off(<span class="string">'scroll.finance'</span>);</span>
<span class="highlight-new">            setupPCScroll();</span>
<span class="highlight-new">            setupKeyboardNavigation();</span>
<span class="highlight-add">        }</span>
        initPanels();
    }, 150);
});</pre>
                </div>
            </div>
        </div>

    </div>
</body>
</html> 코드</div>
                <div class="code">
<pre>$(<span class="keyword">document</span>).ready(<span class="keyword">function</span>() {
    <span class="keyword">const</span> isMobile = () =&gt; window.innerWidth &lt;= 768;
    <span class="highlight-new"><span class="keyword">let</span> isScrolling = <span class="keyword">false</span>; <span class="comment">// 프로그래밍 방식 스크롤 감지용</span></span>
    
    <span class="comment">// 초기 상태 설정</span>
    <span class="keyword">function</span> <span class="function">initPanels</span>() {
        ...</pre>
                </div>
            </div>
        </div>

        <h2 class="section-title">② 새로운 함수 추가: updateActiveButton() - 스크롤 위치에 따라 active 버튼 자동 전환</h2>
        <div class="comparison">
            <div class="panel">
                <div class="panel-header original">기존 코드</div>
                <div class="code">
                    <pre class="highlight-remove"><span class="comment">// 이 함수는 기존 코드에 존재하지 않았습니다</span></pre>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header changed">변경된 코드 (완전히 새로 추가)</div>
                <div class="code">
<pre class="highlight-new"><span class="comment">// 스크롤 위치에 따라 active 버튼 업데이트 (PC 전용)</span>
<span class="keyword">function</span> <span class="function">updateActiveButton</span>() {
    <span class="keyword">if</span> (isMobile() || isScrolling) <span class="keyword">return</span>;
    
    <span class="keyword">const</span> $body = $(<span class="string">'body'</span>);
    <span class="keyword">const</span> scrollTop = $body.scrollTop();
    <span class="keyword">const</span> $header = $(<span class="string">'.headerOn'</span>);
    <span class="keyword">const</span> $anchorList = $(<span class="string">'.anchor-list'</span>);
    <span class="keyword">const</span> headerHeight = $header.outerHeight() || 0;
    <span class="keyword">const</span> anchorListHeight = $anchorList.hasClass(<span class="string">'fixed'</span>) ? 
        ($anchorList.outerHeight() || 0) : 0;
    <span class="keyword">const</span> offset = headerHeight + anchorListHeight + 50;
    
    <span class="keyword">let</span> currentSection = <span class="keyword">null</span>;
    
    <span class="comment">// 현재 보이는 섹션 찾기</span>
    $(<span class="string">'.anchor-panel'</span>).each(<span class="keyword">function</span>() {
        <span class="keyword">const</span> $panel = $(<span class="keyword">this</span>);
        <span class="keyword">const</span> panelTop = $panel.offset().top + scrollTop - offset;
        <span class="keyword">const</span> panelBottom = panelTop + $panel.outerHeight();
        
        <span class="keyword">if</span> (scrollTop &gt;= panelTop &amp;&amp; scrollTop &lt; panelBottom) {
            currentSection = <span class="string">'#'</span> + $panel.attr(<span class="string">'id'</span>);
            <span class="keyword">return false</span>; <span class="comment">// break</span>
        }
    });
    
    <span class="comment">// 최상단일 경우 첫 번째 버튼 활성화</span>
    <span class="keyword">if</span> (!currentSection) {
        currentSection = $(<span class="string">'.anchor-list button'</span>).first().data(<span class="string">'target'</span>);
    }
    
    <span class="keyword">if</span> (currentSection) {
        <span class="keyword">const</span> $targetButton = $(<span class="string">`.anchor-list button[data-target="${currentSection}"]`</span>);
        <span class="keyword">if</span> ($targetButton.length &amp;&amp; !$targetButton.hasClass(<span class="string">'active'</span>)) {
            $(<span class="string">'.anchor-list button'</span>).removeClass(<span class="string">'active'</span>);
            $targetButton.addClass(<span class="string">'active'</span>);
        }
    }
}</pre>
                </div>
            </div>
        </div>

        <h2 class="section-title">③ PC 스크롤 이벤트 추가 - anchor-list fixed 고정 및 active 버튼 자동 업데이트</h2>
        <div class="comparison">
            <div class="panel">
                <div class="panel-header original">기존 코드</div>
                <div class="code">
<pre><span class="comment">// 모바일 스크롤 이벤트 설정</span>
<span class="keyword">function</span> <span class="function">setupMobileScroll</span>() {
    <span class="keyword">const</span> $body = $(<span class="string">'body'</span>);
    <span class="keyword">const</span> $header = $(<span class="string">'.headerOn'</span>);
    <span class="keyword">const</span> $visualContainer = $(<span class="string">'.visual-container'</span>);
    <span class="keyword">const</span> $anchorList = $(<span class="string">'.anchor-list'</span>);
    
    <span class="keyword">const</span> headerHeight = $header.outerHeight() || 0;
    <span class="keyword">const</span> visualHeight = $visualContainer.outerHeight() || 0;
    
    <span class="comment">// 네임스페이스를 사용하여 layout.js의 스크롤 이벤트와 충돌 방지</span>
    $body.off(<span class="string">'scroll.finance'</span>).on(<span class="string">'scroll.finance'</span>, <span class="keyword">function</span>() {
        <span class="keyword">const</span> scrollTop = $body.scrollTop();
        $visualContainer.toggleClass(<span class="string">'sticky'</span>, scrollTop &gt;= headerHeight);
        $anchorList.toggleClass(<span class="string">'fixed'</span>, scrollTop &gt;= headerHeight + visualHeight);
    });
}</pre>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header changed">변경된 코드</div>
                <div class="code">
<pre><span class="comment">// PC 스크롤 이벤트 설정</span>
<span class="highlight-new"><span class="keyword">function</span> <span class="function">setupPCScroll</span>() {</span>
    <span class="keyword">const</span> $body = $(<span class="string">'body'</span>);
    <span class="keyword">const</span> $header = $(<span class="string">'.headerOn'</span>);
    <span class="keyword">const</span> $visualContainer = $(<span class="string">'.visual-container'</span>);
    <span class="keyword">const</span> $anchorList = $(<span class="string">'.anchor-list'</span>);
    
    <span class="keyword">const</span> headerHeight = $header.outerHeight() || 0;
    <span class="keyword">const</span> visualHeight = $visualContainer.outerHeight() || 0;
    
    <span class="comment">// 네임스페이스를 사용하여 layout.js의 스크롤 이벤트와 충돌 방지</span>
    $body.off(<span class="string">'scroll.finance'</span>).on(<span class="string">'scroll.finance'</span>, <span class="keyword">function</span>() {
        <span class="keyword">const</span> scrollTop = $body.scrollTop();
        <span class="highlight-add"><span class="keyword">const</span> shouldBeFixed = scrollTop &gt;= headerHeight + visualHeight;</span>
        
        <span class="highlight-add">$anchorList.toggleClass(<span class="string">'fixed'</span>, shouldBeFixed);</span>
        
        <span class="highlight-new"><span class="comment">// fixed 상태일 때 padding 적용</span></span>
        <span class="highlight-new"><span class="keyword">if</span> (shouldBeFixed &amp;&amp; !$anchorList.data(<span class="string">'padding-applied'</span>)) {</span>
            <span class="highlight-new">$anchorList.css(<span class="string">'padding'</span>, <span class="string">'30px 0'</span>);</span>
            <span class="highlight-new">$anchorList.data(<span class="string">'padding-applied'</span>, <span class="keyword">true</span>);</span>
        <span class="highlight-new">} <span class="keyword">else if</span> (!shouldBeFixed) {</span>
            <span class="highlight-new">$anchorList.css(<span class="string">'padding'</span>, <span class="string">''</span>);</span>
            <span class="highlight-new">$anchorList.data(<span class="string">'padding-applied'</span>, <span class="keyword">false</span>);</span>
        <span class="highlight-new">}</span>
        
        <span class="highlight-new"><span class="comment">// 스크롤 시 active 버튼 업데이트</span></span>
        <span class="highlight-new"><span class="keyword">if</span> (!isScrolling) {</span>
            <span class="highlight-new">updateActiveButton();</span>
        <span class="highlight-new">}</span>
    });
    
    <span class="highlight-new"><span class="comment">// 초기 실행</span></span>
    <span class="highlight-new">updateActiveButton();</span>
}

<span class="comment">// 모바일 스크롤 이벤트 설정</span>
<span class="keyword">function</span> <span class="function">setupMobileScroll</span>() {
    <span class="keyword">const</span> $body = $(<span class="string">'body'</span>);
    <span class="keyword">const</span> $header = $(<span class="string">'.headerOn'</span>);
    <span class="keyword">const</span> $visualContainer = $(<span class="string">'.visual-container'</span>);
    <span class="keyword">const</span> $anchorList = $(<span class="string">'.anchor-list'</span>);
    
    <span class="keyword">const</span> headerHeight = $header.outerHeight() || 0;
    <span class="keyword">const</span> visualHeight = $visualContainer.outerHeight() || 0;
    
    <span class="comment">// 네임스페이스를 사용하여 layout.js의 스크롤 이벤트와 충돌 방지</span>
    $body.off(<span class="string">'scroll.finance'</span>).on(<span class="string">'scroll.finance'</span>, <span class="keyword">function</span>() {
        <span class="keyword">const</span> scrollTop = $body.scrollTop();
        $visualContainer.toggleClass(<span class="string">'sticky'</span>, scrollTop &gt;= headerHeight);
        $anchorList.toggleClass(<span class="string">'fixed'</span>, scrollTop &gt;= headerHeight + visualHeight);
    });
}</pre>
                </div>
            </div>
        </div>

        <h2 class="section-title">④ 키보드 접근성 추가 - 방향키 네비게이션 및 Tab 키 연동</h2>
        <div class="comparison">
            <div class="panel">
                <div class="panel-header original">기존 코드</div>
                <div class="code">
                    <pre class="highlight-remove"><span class="comment">// 키보드 네비게이션 함수는 존재하지 않았습니다</span></pre>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header changed">변경된 코드 (완전히 새로 추가)</div>
                <div class="code">
<pre class="highlight-new"><span class="comment">// 키보드 네비게이션 설정 (PC 전용)</span>
<span class="keyword">function</span> <span class="function">setupKeyboardNavigation</span>() {
    <span class="keyword">if</span> (isMobile()) <span class="keyword">return</span>;
    
    <span class="keyword">const</span> $anchorButtons = $(<span class="string">'.anchor-list button'</span>);
    
    <span class="comment">// anchor-list 버튼에서 방향키로 이동</span>
    $anchorButtons.off(<span class="string">'keydown.finance'</span>).on(<span class="string">'keydown.finance'</span>, <span class="keyword">function</span>(e) {
        <span class="keyword">const</span> $current = $(<span class="keyword">this</span>);
        <span class="keyword">const</span> currentIndex = $anchorButtons.index($current);
        
        <span class="keyword">if</span> (e.key === <span class="string">'ArrowRight'</span> || e.key === <span class="string">'ArrowDown'</span>) {
            e.preventDefault();
            <span class="keyword">const</span> nextIndex = (currentIndex + 1) % $anchorButtons.length;
            $anchorButtons.eq(nextIndex).focus().click();
        } <span class="keyword">else if</span> (e.key === <span class="string">'ArrowLeft'</span> || e.key === <span class="string">'ArrowUp'</span>) {
            e.preventDefault();
            <span class="keyword">const</span> prevIndex = (currentIndex - 1 + $anchorButtons.length) % $anchorButtons.length;
            $anchorButtons.eq(prevIndex).focus().click();
        }
    });
    
    <span class="comment">// visual-container 마지막 버튼에서 Tab으로 anchor-list 이동 시 스크롤</span>
    $(<span class="string">'.visual-container .btn-primary'</span>).last()
        .off(<span class="string">'keydown.tabtonav'</span>)
        .on(<span class="string">'keydown.tabtonav'</span>, <span class="keyword">function</span>(e) {
            <span class="keyword">if</span> (e.key === <span class="string">'Tab'</span> &amp;&amp; !e.shiftKey) {
                <span class="keyword">const</span> $anchorList = $(<span class="string">'.anchor-list'</span>);
                <span class="keyword">if</span> ($anchorList.hasClass(<span class="string">'fixed'</span>) || $anchorList.is(<span class="string">':visible'</span>)) {
                    setTimeout(<span class="keyword">function</span>() {
                        <span class="keyword">const</span> $firstButton = $(<span class="string">'.anchor-list button'</span>).first();
                        <span class="keyword">if</span> ($firstButton.is(<span class="string">':focus'</span>)) {
                            <span class="keyword">const</span> target = $firstButton.data(<span class="string">'target'</span>);
                            <span class="keyword">const</span> $target = $(target);
                            <span class="keyword">if</span> ($target.length) {
                                <span class="keyword">const</span> $header = $(<span class="string">'.headerOn'</span>);
                                <span class="keyword">const</span> $anchorList = $(<span class="string">'.anchor-list'</span>);
                                <span class="keyword">const</span> headerHeight = $header.outerHeight() || 0;
                                <span class="keyword">const</span> anchorListHeight = $anchorList.outerHeight() || 0;
                                <span class="keyword">const</span> offset = headerHeight + anchorListHeight;
                                
                                $(<span class="string">'body'</span>).stop().animate({
                                    scrollTop: $target.offset().top + $(<span class="string">'body'</span>).scrollTop() - offset
                                }, 400);
                            }
                        }
                    }, 100);
                }
            }
        });
}</pre>
                </div>
            </div>
        </div>

        <h2 class="section-title">⑤ 초기화 부분 변경 - PC/모바일 구분</h2>
        <div class="comparison">
            <div class="panel">
                <div class="panel-header original">기존 코드</div>
                <div class="code">
<pre><span class="comment">// 초기화</span>
initPanels();
<span class="highlight-remove"><span class="keyword">if</span> (isMobile()) setupMobileScroll();</span></pre>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header changed">변경된 코드</div>
                <div class="code">
<pre><span class="comment">// 초기화</span>
initPanels();
<span class="highlight-add"><span class="keyword">if</span> (isMobile()) {</span>
    <span class="highlight-add">setupMobileScroll();</span>
<span class="highlight-add">} <span class="keyword">else</span> {</span>
    <span class="highlight-new">setupPCScroll();</span>
    <span class="highlight-new">setupKeyboardNavigation();</span>
<span class="highlight-add">}</span></pre>
                </div>
            </div>
        </div>

        <h2 class="section-title">⑥ 버튼 클릭 이벤트 수정 - 프로그래밍 방식 스크롤 플래그 추가</h2>
        <div class="comparison">
            <div class="panel">
                <div class="panel-header original">기존 코드</div>
                <div class="code">
<pre>$(<span class="string">'.anchor-list button'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>(e) {
    e.preventDefault();
    <span class="keyword">const</span> $this = $(<span class="keyword">this</span>);
    <span class="keyword">const</span> target = $this.data(<span class="string">'target'</span>);
    
    $(<span class="string">'.anchor-list button'</span>).removeClass(<span class="string">'active'</span>);
    $this.addClass(<span class="string">'active'</span>);
    
    <span class="keyword">if</span> (isMobile()) {
        <span class="comment">// 모바일: 탭 전환 (코드 동일)</span>
        ...
    } <span class="keyword">else</span> {
        <span class="comment">// PC: 스크롤 이동</span>
        <span class="keyword">const</span> $target = $(target);
        <span class="keyword">if</span> ($target.length) {
            <span class="keyword">const</span> headerHeight = $(<span class="string">'.headerOn'</span>).outerHeight() || 0;
            <span class="keyword">const</span> anchorListHeight = $(<span class="string">'.anchor-list'</span>).outerHeight() || 0;
            <span class="keyword">const</span> offset = headerHeight + anchorListHeight - 70;
            
            $(<span class="string">'body'</span>).stop().animate({
                scrollTop: $target.offset().top + $(<span class="string">'body'</span>).scrollTop() - offset
            }, 400);
        }
    }
});</pre>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header changed">변경된 코드</div>
                <div class="code">
<pre>$(<span class="string">'.anchor-list button'</span>).on(<span class="string">'click'</span>, <span class="keyword">function</span>(e) {
    e.preventDefault();
    <span class="keyword">const</span> $this = $(<span class="keyword">this</span>);
    <span class="keyword">const</span> target = $this.data(<span class="string">'target'</span>);
    
    $(<span class="string">'.anchor-list button'</span>).removeClass(<span class="string">'active'</span>);
    $this.addClass(<span class="string">'active'</span>);
    
    <span class="keyword">if</span> (isMobile()) {
        <span class="comment">// 모바일: 탭 전환 (코드 동일)</span>
        ...
    } <span class="keyword">else</span> {
        <span class="comment">// PC: 스크롤 이동</span>
        <span class="keyword">const</span> $target = $(target);
        <span class="keyword">if</span> ($target.length) {
            <span class="highlight-new">isScrolling = <span class="keyword">true</span>; <span class="comment">// 플래그 설정</span></span>
            
            <span class="keyword">const</span> $header = $(<span class="string">'.headerOn'</span>);
            <span class="keyword">const</span> $anchorList = $(<span class="string">'.anchor-list'</span>);
            <span class="keyword">const</span> headerHeight = $header.outerHeight() || 0;
            <span class="highlight-add"><span class="keyword">const</span> anchorListHeight = ($anchorList.hasClass(<span class="string">'fixed'</span>) ? </span>
                <span class="highlight-add">$anchorList.outerHeight() : 0) || 0;</span>
            <span class="highlight-add"><span class="keyword">const</span> offset = headerHeight + anchorListHeight;</span>
            
            $(<span class="string">'body'</span>).stop().animate({
                scrollTop: $target.offset().top + $(<span class="string">'body'</span>).scrollTop() - offset
            }, 400<span class="highlight-new">, <span class="keyword">function</span>() {</span>
                <span class="highlight-new">isScrolling = <span class="keyword">false</span>; <span class="comment">// 애니메이션 완료 후 플래그 해제</span></span>
            <span class="highlight-new">}</span>);
        }
    }
});</pre>
                </div>
            </div>
        </div>

        <h2 class="section-title">⑦ 리사이즈 이벤트 수정 - PC 전환 시 이벤트 재설정</h2>
        <div class="comparison">
            <div class="panel">
                <div class="panel-header original">기존 코드</div>
                <div class="code">
<pre><span class="keyword">let</span> resizeTimer;
$(window).on(<span class="string">'resize'</span>, <span class="keyword">function</span>() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(() => {
<span class="highlight-remove">        <span class="keyword">if</span> (isMobile()) {
            setupMobileScroll();
        } <span class="keyword">else</span> {
            $(<span class="string">'.visual-container'</span>).removeClass(<span class="string">'sticky'</span>);
            $(<span class="string">'.anchor-list'</span>).removeClass(<span class="string">'fixed'</span>);
            $(<span class="string">'body'</span>).off(<span class="string">'scroll.finance'</span>);
        }</span>
        initPanels();
    }, 150);
});</pre>
                </div>
            </div>
            <div class="panel">
                <div class="panel-header changed">변경된